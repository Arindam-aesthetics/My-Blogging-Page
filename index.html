<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>My Blog</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    html { -webkit-text-size-adjust: 100%; scroll-behavior: smooth; }
    body { margin: 0; background: #faf9f7; font-family: 'Lora', Georgia, serif; overscroll-behavior-y: none; color: #1a1a1a; }
    button, input, textarea { -webkit-appearance: none; appearance: none; font-family: inherit; }
    img { max-width: 100%; height: auto; display: block; }
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: #faf9f7; }
    ::-webkit-scrollbar-thumb { background: #ddd; border-radius: 3px; }
    @keyframes fadeUp { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:translateY(0)} }
    @keyframes shake  { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }
    @keyframes scaleIn{ from{opacity:0;transform:scale(0.95)} to{opacity:1;transform:scale(1)} }
    @keyframes spin   { to{transform:rotate(360deg)} }

    .view { display:none; }
    .view.active { display:block; }

    /* NAV */
    .site-nav { position:sticky;top:0;z-index:10;background:rgba(250,249,247,0.96);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-bottom:1px solid #ece9e4;padding:0.85rem 1.1rem;display:flex;justify-content:space-between;align-items:center; }
    @media(min-width:600px){.site-nav{padding:1rem 2rem}}
    .nav-logo { font-size:1rem;font-weight:600;color:#1a1a1a;font-family:'Lora',Georgia,serif; }
    .nav-right { display:flex;align-items:center;gap:0.65rem; }

    /* BUTTONS */
    .btn-primary { display:inline-flex;align-items:center;justify-content:center;padding:0.65rem 1.4rem;background:#2c2c2c;color:#fff;border:none;border-radius:8px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.88rem;font-weight:500;min-height:44px;transition:background 0.18s,transform 0.12s;-webkit-tap-highlight-color:transparent;white-space:nowrap; }
    .btn-primary:active{transform:scale(0.97);background:#111}
    .btn-primary:disabled{background:#ccc;cursor:not-allowed}
    .btn-ghost { display:inline-flex;align-items:center;justify-content:center;padding:0.6rem 1.2rem;background:transparent;color:#777;border:1.5px solid #e0dcd8;border-radius:8px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.88rem;min-height:44px;transition:border-color 0.18s,color 0.18s;-webkit-tap-highlight-color:transparent;white-space:nowrap; }
    .btn-ghost:active{border-color:#bbb;color:#444}
    .btn-danger { display:inline-flex;align-items:center;justify-content:center;padding:0.6rem 1.2rem;background:transparent;color:#e0827c;border:1.5px solid #e0827c;border-radius:8px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.88rem;min-height:44px;-webkit-tap-highlight-color:transparent;white-space:nowrap; }
    .btn-danger:active{background:#fdf0ef}
    .btn-text { background:none;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.78rem;color:#9b8ea0;padding:0.5rem;min-height:44px;-webkit-tap-highlight-color:transparent; }
    .btn-nav-new { display:none;border-radius:20px!important;padding:0.45rem 1.1rem!important;font-size:0.8rem!important;min-height:36px!important; }
    @media(min-width:600px){.btn-nav-new{display:inline-flex}}

    /* FAB */
    .fab { position:fixed;bottom:calc(1.5rem + env(safe-area-inset-bottom,0px));right:1.25rem;width:54px;height:54px;background:#2c2c2c;color:#fff;border:none;border-radius:50%;font-size:1.5rem;cursor:pointer;box-shadow:0 6px 24px rgba(0,0,0,0.2);display:none;align-items:center;justify-content:center;z-index:50;-webkit-tap-highlight-color:transparent;transition:transform 0.15s,box-shadow 0.15s; }
    .fab:active{transform:scale(0.92);box-shadow:0 3px 12px rgba(0,0,0,0.15)}
    .fab.visible{display:flex}
    @media(min-width:600px){.fab{display:none!important}}

    /* HERO */
    .hero { max-width:760px;margin:0 auto;padding:2.25rem 1.1rem 1.75rem; }
    @media(min-width:600px){.hero{padding:3.5rem 2rem 2.5rem}}
    .hero h1 { font-size:clamp(2rem,9vw,2.5rem);font-weight:700;color:#1a1a1a;line-height:1.2;margin:0 0 0.85rem;font-family:'Lora',Georgia,serif; }
    @media(min-width:600px){.hero h1{font-size:clamp(2.4rem,5vw,3.2rem)}}
    .hero p { font-size:0.93rem;color:#8a8078;line-height:1.8;max-width:460px;margin:0;font-family:'Lora',Georgia,serif; }
    @media(min-width:600px){.hero p{font-size:1rem}}
    .hero-divider { margin-top:1.4rem;height:2px;width:36px;background:#2c2c2c;border-radius:2px; }

    /* POSTS */
    .posts-main { max-width:760px;margin:0 auto;padding:0 1.1rem calc(5.5rem + env(safe-area-inset-bottom,0px)); }
    @media(min-width:600px){.posts-main{padding:0 2rem 6rem}}
    .posts-grid { display:grid;grid-template-columns:1fr;gap:0.9rem; }
    @media(min-width:600px){.posts-grid{grid-template-columns:repeat(2,1fr);gap:1.2rem}}
    .empty-state { text-align:center;padding:4rem 0;color:#c0b8b0;font-family:'DM Sans',sans-serif;font-size:0.9rem; }
    .empty-state p { margin:0 0 1.25rem; }

    /* POST CARD */
    .post-card { cursor:pointer;background:#fff;border:1px solid #ece9e4;border-radius:14px;overflow:hidden;transition:box-shadow 0.22s ease,transform 0.22s ease,border-color 0.22s ease;animation:fadeUp 0.38s ease both;-webkit-tap-highlight-color:transparent; }
    .post-card:active{transform:scale(0.98)}
    @media(hover:hover){.post-card:hover{box-shadow:0 8px 32px rgba(0,0,0,0.08);transform:translateY(-3px);border-color:#d5d0cb}}
    .post-card-img { width:100%;height:195px;object-fit:cover;display:block; }
    .post-card-body { padding:1.2rem 1.3rem 1.4rem; }
    .post-meta { display:flex;gap:0.65rem;align-items:center;flex-wrap:wrap;margin-bottom:0.6rem; }
    .post-meta span { font-size:0.69rem;color:#b0a9a0;font-family:'DM Sans',sans-serif; }
    .post-meta .dot { color:#e0dcd8; }
    .post-card-title { font-size:1.12rem;font-weight:700;color:#1a1a1a;line-height:1.35;margin:0 0 0.6rem;font-family:'Lora',Georgia,serif;word-break:break-word; }
    .post-card-excerpt { font-size:0.87rem;color:#7a7470;line-height:1.75;margin:0;font-family:'Lora',Georgia,serif;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden; }
    .post-card-read-more { margin-top:1rem;font-size:0.74rem;color:#9b8ea0;font-family:'DM Sans',sans-serif;letter-spacing:0.04em; }

    /* POST VIEW */
    #view-post .post-nav { padding:0.85rem 1rem;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #ece9e4;background:rgba(250,249,247,0.96);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);position:sticky;top:0;z-index:10; }
    @media(min-width:600px){#view-post .post-nav{padding:1rem 1.5rem}}
    .btn-back { background:none;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:0.88rem;color:#888;display:flex;align-items:center;gap:6px;padding:0.5rem 0;min-height:44px;min-width:44px;-webkit-tap-highlight-color:transparent; }
    .post-admin-btns { display:flex;gap:0.5rem; }
    .post-article { max-width:680px;margin:0 auto;padding:1.75rem 1.15rem calc(3rem + env(safe-area-inset-bottom,0px)); }
    @media(min-width:600px){.post-article{padding:3rem 1.5rem 6rem}}
    .post-cover-img { width:100%;border-radius:10px;margin-bottom:1.5rem;object-fit:cover;max-height:260px; }
    @media(min-width:600px){.post-cover-img{border-radius:14px;margin-bottom:2.25rem;max-height:420px}}
    .post-article .post-meta { margin-bottom:0.9rem; }
    .post-article .post-meta span { font-size:0.73rem; }
    .post-article h1 { font-size:clamp(1.55rem,7.5vw,2rem);font-weight:700;color:#1a1a1a;line-height:1.25;margin:0 0 1.4rem;font-family:'Lora',Georgia,serif;word-break:break-word; }
    @media(min-width:600px){.post-article h1{font-size:clamp(1.9rem,4vw,2.6rem);margin-bottom:1.9rem}}
    .prose { font-size:clamp(1rem,2.6vw,1.08rem);line-height:1.92;color:#3a3535;white-space:pre-wrap;font-family:'Lora',Georgia,serif;word-break:break-word;overflow-wrap:break-word; }

    /* EDITOR */
    .editor-topbar { position:sticky;top:0;z-index:20;background:rgba(250,249,247,0.96);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-bottom:1px solid #ece9e4;padding:0.8rem 1rem;display:flex;justify-content:space-between;align-items:center;gap:0.5rem; }
    @media(min-width:600px){.editor-topbar{padding:0.9rem 1.5rem}}
    .editor-label { font-size:0.7rem;letter-spacing:0.18em;text-transform:uppercase;color:#9b8ea0;font-family:'DM Sans',sans-serif;flex-shrink:0; }
    .editor-topbar-btns { display:flex;gap:0.5rem; }
    .editor-body-wrap { max-width:720px;margin:0 auto;padding:1.5rem 1.1rem 5rem; }
    @media(min-width:600px){.editor-body-wrap{padding:2rem 1.5rem 5rem}}
    .cover-upload-zone { width:100%;height:130px;border:2px dashed #e0dcd8;border-radius:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;margin-bottom:1.5rem;overflow:hidden;background:#fff;position:relative; }
    @media(min-width:600px){.cover-upload-zone{height:170px}}
    .cover-upload-placeholder { text-align:center;color:#c0b8b0;font-family:'DM Sans',sans-serif; }
    .cover-upload-placeholder .icon { font-size:1.6rem;margin-bottom:5px; }
    .cover-upload-placeholder .hint { font-size:0.76rem; }
    .cover-remove-btn { position:absolute;top:10px;right:10px;background:rgba(0,0,0,0.5);color:#fff;border:none;border-radius:50%;width:34px;height:34px;display:flex;align-items:center;justify-content:center;font-size:0.9rem;cursor:pointer; }
    .editor-title-input { width:100%;font-size:clamp(1.45rem,5.5vw,2rem);font-weight:700;border:none;background:transparent;outline:none;color:#1a1a1a;font-family:'Lora',Georgia,serif;margin-bottom:1.25rem;line-height:1.3;display:block;padding:0; }
    .editor-content-input { width:100%;min-height:50vh;font-size:1.02rem;line-height:1.9;border:none;background:transparent;outline:none;color:#3a3535;font-family:'Lora',Georgia,serif;resize:none;display:block;padding:0; }
    .editor-footer { margin-top:1.25rem;padding:0.9rem 0;border-top:1px solid #ece9e4;font-size:0.73rem;color:#c0b8b0;font-family:'DM Sans',sans-serif; }

    /* TOAST */
    .saving-toast { position:fixed;bottom:calc(1.5rem + env(safe-area-inset-bottom,0px));left:50%;transform:translateX(-50%) translateY(80px);background:#2c2c2c;color:#fff;padding:0.6rem 1.2rem;border-radius:20px;font-family:'DM Sans',sans-serif;font-size:0.8rem;z-index:200;transition:transform 0.3s ease,opacity 0.3s ease;opacity:0;display:flex;align-items:center;gap:0.5rem;white-space:nowrap; }
    .saving-toast.show{transform:translateX(-50%) translateY(0);opacity:1}
    .spinner { width:14px;height:14px;border:2px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:spin 0.7s linear infinite;display:none;flex-shrink:0; }
    .spinner.visible{display:block}

    /* LOGIN MODAL */
    .modal-overlay { display:none;position:fixed;inset:0;background:rgba(250,249,247,0.9);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);align-items:center;justify-content:center;z-index:100;padding:1rem; }
    .modal-overlay.open{display:flex}
    .modal-box { background:#fff;border-radius:18px;padding:2rem 1.75rem;width:100%;max-width:360px;box-shadow:0 24px 64px rgba(0,0,0,0.13);animation:scaleIn 0.22s ease; }
    .modal-box.shake{animation:shake 0.4s ease}
    .modal-title { font-size:1.12rem;font-weight:700;color:#1a1a1a;font-family:'Lora',Georgia,serif;margin:0 0 5px; }
    .modal-sub { font-size:0.8rem;color:#aaa;font-family:'DM Sans',sans-serif;margin:0 0 1.4rem;line-height:1.5; }
    .modal-input { width:100%;padding:0.85rem 1rem;border-radius:10px;border:1.5px solid #e0dcd8;font-size:1rem;outline:none;font-family:'DM Sans',sans-serif;background:#faf9f7;color:#1a1a1a;min-height:50px;transition:border-color 0.18s;display:block; }
    .modal-input.error{border-color:#e0827c}
    .modal-error { font-size:0.73rem;color:#e0827c;font-family:'DM Sans',sans-serif;margin:0.4rem 0 1rem;display:none; }
    .modal-error.visible{display:block}
    .modal-btns { display:flex;gap:0.6rem; }
    .modal-btns .btn-ghost,.modal-btns .btn-primary{flex:1}
    .modal-hint { font-size:0.67rem;color:#d0c8c0;text-align:center;margin:1.2rem 0 0;font-family:'DM Sans',sans-serif; }

    /* FOOTER */
    .site-footer { border-top:1px solid #ece9e4;padding:1.4rem 1rem calc(1.4rem + env(safe-area-inset-bottom,0px));text-align:center;color:#c8c0b8;font-family:'DM Sans',sans-serif;font-size:0.7rem;letter-spacing:0.08em; }

    /* LOADING */
    #loading-screen { min-height:100vh;display:flex;align-items:center;justify-content:center;background:#faf9f7; }
    #loading-screen span { color:#c0b8b0;font-family:Georgia,serif;font-size:0.9rem;letter-spacing:0.2em; }
  </style>
</head>
<body>

<!-- LOADING -->
<div id="loading-screen"><span>loading...</span></div>

<!-- TOAST -->
<div class="saving-toast" id="toast">
  <div class="spinner" id="toast-spinner"></div>
  <span id="toast-msg">Savingâ€¦</span>
</div>

<!-- LOGIN MODAL -->
<div class="modal-overlay" id="login-modal">
  <div class="modal-box" id="login-box">
    <p class="modal-title">Admin Access</p>
    <p class="modal-sub">Enter your password to write and manage posts</p>
    <input class="modal-input" type="password" id="pw-input" placeholder="Password" />
    <p class="modal-error" id="pw-error">Incorrect password â€” try again</p>
    <div class="modal-btns">
      <button class="btn-ghost" id="modal-cancel">Cancel</button>
      <button class="btn-primary" id="modal-enter">Enter</button>
    </div>
    <p class="modal-hint">Default password: <em>myblog2024</em></p>
  </div>
</div>

<!-- HOME VIEW -->
<div class="view" id="view-home">
  <nav class="site-nav">
    <span class="nav-logo">âœ¦ My Blog</span>
    <div class="nav-right">
      <button class="btn-primary btn-nav-new" id="nav-new-btn" style="display:none">ï¼‹ New Post</button>
      <button class="btn-text" id="nav-admin-btn">Admin</button>
    </div>
  </nav>
  <header class="hero">
    <h1>Thoughts, stories<br>&amp; ideas.</h1>
    <p>A personal space for writing. No algorithm, no noise â€” just words.</p>
    <div class="hero-divider"></div>
  </header>
  <main class="posts-main">
    <div id="posts-grid" class="posts-grid"></div>
    <div id="empty-state" class="empty-state" style="display:none">
      <p id="empty-text">No posts yet. Check back soon.</p>
      <button class="btn-primary" id="empty-write-btn" style="display:none">Write a Post</button>
    </div>
  </main>
  <button class="fab" id="fab-btn" aria-label="New Post">ï¼‹</button>
  <footer class="site-footer">Made with care Â· <span id="footer-year"></span></footer>
</div>

<!-- POST VIEW -->
<div class="view" id="view-post">
  <nav class="post-nav">
    <button class="btn-back" id="post-back-btn">â† Back</button>
    <div class="post-admin-btns" id="post-admin-btns" style="display:none">
      <button class="btn-ghost" id="post-edit-btn" style="padding:0.45rem 0.8rem;font-size:0.8rem">Edit</button>
      <button class="btn-danger" id="post-delete-btn" style="padding:0.45rem 0.8rem;font-size:0.8rem">Delete</button>
    </div>
  </nav>
  <article class="post-article" id="post-article"></article>
</div>

<!-- EDITOR VIEW -->
<div class="view" id="view-editor">
  <div class="editor-topbar">
    <span class="editor-label" id="editor-label">âœ¦ New Post</span>
    <div class="editor-topbar-btns">
      <button class="btn-ghost" id="editor-cancel-btn" style="padding:0.5rem 0.9rem">Cancel</button>
      <button class="btn-primary" id="editor-publish-btn" style="padding:0.5rem 0.9rem" disabled>Publish</button>
    </div>
  </div>
  <div class="editor-body-wrap">
    <div class="cover-upload-zone" id="cover-zone">
      <div class="cover-upload-placeholder" id="cover-placeholder">
        <div class="icon">ğŸ“·</div>
        <div class="hint">Tap to add a cover image</div>
      </div>
      <button class="cover-remove-btn" id="cover-remove-btn" style="display:none">âœ•</button>
    </div>
    <input type="file" accept="image/*" capture="environment" id="cover-file-input" style="display:none" />
    <input class="editor-title-input" id="editor-title" placeholder="Post title..." />
    <textarea class="editor-content-input" id="editor-content" placeholder="Write your story here..."></textarea>
    <div class="editor-footer" id="editor-footer">0 words Â· 1 min read</div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  â–¼â–¼â–¼  PASTE YOUR VALUES HERE â€” NOTHING ELSE TO CHANGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const API_KEY        = "$2a$10$Q1IbkiYit15c6WbMQI7VBuldRdck7HqnElid/y9dwOx8I0PFEoW2G";
const BIN_ID         = "6991996d43b1c97be9807dfb";
const ADMIN_PASSWORD = "myblog2024";
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const BASE = "https://api.jsonbin.io/v3";

// â”€â”€ STATE â”€â”€
let posts            = [];
let isAdmin          = false;
let currentPostId    = null;
let editingPost      = null;
let editorCoverImage = null;

// â”€â”€ HELPERS â”€â”€
function estimateReadTime(t) { return Math.ceil(t.trim().split(/\s+/).filter(Boolean).length / 200) + " min read"; }
function wordCount(t) { const w = t.trim().split(/\s+/).filter(Boolean).length; return w + " word" + (w !== 1 ? "s" : ""); }
function formatDate(iso) { return new Date(iso).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}); }
function escapeHtml(s) { return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"); }

let _tt = null;
function showToast(msg, spin=false) {
  document.getElementById("toast-msg").textContent = msg;
  document.getElementById("toast-spinner").classList.toggle("visible", spin);
  document.getElementById("toast").classList.add("show");
  if (_tt) clearTimeout(_tt);
  if (!spin) _tt = setTimeout(() => document.getElementById("toast").classList.remove("show"), 2400);
}
function hideToast() { document.getElementById("toast").classList.remove("show"); if(_tt) clearTimeout(_tt); }

// â”€â”€ JSONBIN â”€â”€
async function fetchPosts() {
  const r = await fetch(`${BASE}/b/${BIN_ID}/latest`, {
    headers: { "X-Master-Key": API_KEY }
  });
  if (!r.ok) throw new Error(r.status);
  const d = await r.json();
  return d.record.posts || [];
}

async function savePosts(arr) {
  const r = await fetch(`${BASE}/b/${BIN_ID}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json", "X-Master-Key": API_KEY },
    body: JSON.stringify({ posts: arr })
  });
  if (!r.ok) throw new Error(r.status);
  posts = arr;
}

// â”€â”€ VIEWS â”€â”€
function showView(id) {
  document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
  document.getElementById("view-" + id).classList.add("active");
  window.scrollTo(0, 0);
}

// â”€â”€ HOME â”€â”€
function renderHome() {
  const grid      = document.getElementById("posts-grid");
  const empty     = document.getElementById("empty-state");
  const navNew    = document.getElementById("nav-new-btn");
  const fab       = document.getElementById("fab-btn");
  const adminBtn  = document.getElementById("nav-admin-btn");

  adminBtn.textContent = isAdmin ? "Sign out" : "Admin";
  navNew.style.display = isAdmin ? "" : "none";
  fab.classList.toggle("visible", isAdmin);

  if (posts.length === 0) {
    grid.innerHTML = ""; grid.style.display = "none";
    empty.style.display = "block";
    document.getElementById("empty-text").textContent = isAdmin ? "No posts yet. Write your first one!" : "No posts yet. Check back soon.";
    document.getElementById("empty-write-btn").style.display = isAdmin ? "inline-flex" : "none";
  } else {
    empty.style.display = "none"; grid.style.display = "";
    grid.innerHTML = posts.map((p,i) => `
      <div class="post-card" data-id="${escapeHtml(p.id)}" style="animation-delay:${i*55}ms">
        ${p.coverImage ? `<img class="post-card-img" src="${escapeHtml(p.coverImage)}" alt="" loading="lazy"/>` : ""}
        <div class="post-card-body">
          <div class="post-meta"><span>${formatDate(p.date)}</span><span class="dot">Â·</span><span>${escapeHtml(p.readTime)}</span></div>
          <h2 class="post-card-title">${escapeHtml(p.title)}</h2>
          <p class="post-card-excerpt">${escapeHtml(p.content)}</p>
          <div class="post-card-read-more">Read more â†’</div>
        </div>
      </div>`).join("");
    grid.querySelectorAll(".post-card").forEach(c => c.addEventListener("click", () => openPost(c.dataset.id)));
  }
  document.getElementById("footer-year").textContent = new Date().getFullYear();
  showView("home");
}

// â”€â”€ POST VIEW â”€â”€
function openPost(id) {
  const p = posts.find(x => x.id === id); if (!p) return;
  currentPostId = id;
  document.getElementById("post-admin-btns").style.display = isAdmin ? "flex" : "none";
  document.getElementById("post-article").innerHTML = `
    ${p.coverImage ? `<img class="post-cover-img" src="${escapeHtml(p.coverImage)}" alt="cover"/>` : ""}
    <div class="post-meta"><span>${formatDate(p.date)}</span><span class="dot">Â·</span><span>${escapeHtml(p.readTime)}</span></div>
    <h1>${escapeHtml(p.title)}</h1>
    <div class="prose">${escapeHtml(p.content)}</div>`;
  showView("post");
}

// â”€â”€ EDITOR â”€â”€
function openEditor(post=null) {
  editingPost = post; editorCoverImage = post?.coverImage || null;
  document.getElementById("editor-label").textContent = post ? "âœ¦ Edit" : "âœ¦ New Post";
  document.getElementById("editor-title").value   = post?.title   || "";
  document.getElementById("editor-content").value = post?.content || "";
  updateCoverZone(); updateEditorFooter(); updatePublishBtn();
  showView("editor");
}

function updateCoverZone() {
  const zone = document.getElementById("cover-zone");
  const ph   = document.getElementById("cover-placeholder");
  const rb   = document.getElementById("cover-remove-btn");
  const old  = zone.querySelector("img"); if (old) old.remove();
  if (editorCoverImage) {
    const img = document.createElement("img");
    img.src = editorCoverImage;
    img.style.cssText = "position:absolute;inset:0;width:100%;height:100%;object-fit:cover;";
    zone.insertBefore(img, zone.firstChild);
    ph.style.display = "none"; rb.style.display = "flex";
    zone.style.height = "auto"; zone.style.minHeight = "130px";
  } else {
    ph.style.display = "block"; rb.style.display = "none";
    zone.style.height = ""; zone.style.minHeight = "";
  }
}

function updateEditorFooter() {
  const c = document.getElementById("editor-content").value;
  document.getElementById("editor-footer").textContent = wordCount(c) + " Â· " + estimateReadTime(c);
}

function updatePublishBtn() {
  const t = document.getElementById("editor-title").value.trim();
  const b = document.getElementById("editor-publish-btn");
  b.disabled = !t; b.style.background = t ? "#2c2c2c" : "#ccc"; b.style.cursor = t ? "pointer" : "not-allowed";
}

async function handlePublish() {
  const title   = document.getElementById("editor-title").value.trim();
  const content = document.getElementById("editor-content").value.trim();
  if (!title) return;
  showToast("Savingâ€¦", true);
  const post = {
    id:         editingPost?.id || "post_" + Date.now(),
    title, content,
    coverImage: editorCoverImage,
    date:       editingPost?.date || new Date().toISOString(),
    readTime:   estimateReadTime(content)
  };
  const updated = editingPost
    ? posts.map(p => p.id === editingPost.id ? post : p)
    : [post, ...posts];
  try {
    await savePosts(updated);
    editingPost = null;
    hideToast(); showToast("Published âœ“");
    renderHome();
  } catch(e) {
    console.error(e);
    showToast("Error saving â€” check console");
  }
}

// â”€â”€ LOGIN â”€â”€
function openLogin() {
  document.getElementById("pw-input").value = "";
  document.getElementById("pw-error").classList.remove("visible");
  document.getElementById("pw-input").classList.remove("error");
  document.getElementById("login-box").classList.remove("shake");
  document.getElementById("login-modal").classList.add("open");
  setTimeout(() => document.getElementById("pw-input").focus(), 50);
}
function closeLogin() { document.getElementById("login-modal").classList.remove("open"); }
function tryLogin() {
  if (document.getElementById("pw-input").value === ADMIN_PASSWORD) {
    isAdmin = true; closeLogin(); renderHome();
  } else {
    document.getElementById("pw-error").classList.add("visible");
    document.getElementById("pw-input").classList.add("error");
    const b = document.getElementById("login-box");
    b.classList.remove("shake"); void b.offsetWidth; b.classList.add("shake");
  }
}

// â”€â”€ EVENTS â”€â”€
function initEvents() {
  document.getElementById("modal-cancel").addEventListener("click", closeLogin);
  document.getElementById("modal-enter").addEventListener("click", tryLogin);
  document.getElementById("pw-input").addEventListener("keydown", e => { if(e.key==="Enter") tryLogin(); });
  document.getElementById("pw-input").addEventListener("input", () => {
    document.getElementById("pw-error").classList.remove("visible");
    document.getElementById("pw-input").classList.remove("error");
  });
  document.getElementById("nav-admin-btn").addEventListener("click", () => { if(isAdmin){isAdmin=false;renderHome();}else openLogin(); });
  document.getElementById("nav-new-btn").addEventListener("click", () => openEditor());
  document.getElementById("fab-btn").addEventListener("click", () => openEditor());
  document.getElementById("empty-write-btn").addEventListener("click", () => openEditor());
  document.getElementById("post-back-btn").addEventListener("click", () => renderHome());
  document.getElementById("post-edit-btn").addEventListener("click", () => { const p=posts.find(x=>x.id===currentPostId); if(p) openEditor(p); });
  document.getElementById("post-delete-btn").addEventListener("click", async () => {
    if (!confirm("Delete this post?")) return;
    showToast("Deletingâ€¦", true);
    try {
      await savePosts(posts.filter(p => p.id !== currentPostId));
      currentPostId = null; hideToast(); showToast("Deleted"); renderHome();
    } catch(e) { console.error(e); showToast("Error â€” check console"); }
  });
  document.getElementById("editor-cancel-btn").addEventListener("click", () => { editingPost=null; if(currentPostId) openPost(currentPostId); else renderHome(); });
  document.getElementById("editor-publish-btn").addEventListener("click", handlePublish);
  document.getElementById("editor-title").addEventListener("input", updatePublishBtn);
  document.getElementById("editor-content").addEventListener("input", updateEditorFooter);
  document.getElementById("cover-zone").addEventListener("click", () => document.getElementById("cover-file-input").click());
  document.getElementById("cover-remove-btn").addEventListener("click", e => { e.stopPropagation(); editorCoverImage=null; updateCoverZone(); });
  document.getElementById("cover-file-input").addEventListener("change", e => {
    const f = e.target.files[0]; if(!f) return;
    const r = new FileReader();
    r.onload = ev => { editorCoverImage=ev.target.result; updateCoverZone(); };
    r.readAsDataURL(f); e.target.value = "";
  });
}

// â”€â”€ INIT â”€â”€
async function init() {
  initEvents();
  try {
    posts = await fetchPosts();
  } catch(e) {
    console.error("Could not load posts:", e);
    posts = [];
  }
  document.getElementById("loading-screen").style.display = "none";
  renderHome();
}

init();
</script>
</body>
</html>